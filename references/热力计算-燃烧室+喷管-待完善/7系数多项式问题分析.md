# 7 系数多项式高温失效问题分析

## 1. 问题描述

在使用 `references/热力计算-燃烧室+喷管-待完善/` 程序计算 RS-25 发动机燃烧室温度时，
得到的结果约为 **3471K (3198°C)**，而：

- NASA CEA / RPA 软件计算结果：~3916K (~3643°C)
- 维基百科记载：~3573K (~3300°C，考虑热损失)

差异根源在于 **7 系数多项式在高温区间（>2000K）严重失效**。

---

## 2. 代码分析

### 2.1 焓计算函数 (`relichanshu.h`)

```cpp
double H_i(int i, double T, std::vector<std::vector<double>> HS_a) // 标准摩尔焓
{
    double Ho_i = Ro * (HS_a[i][0] * T
                      + HS_a[i][1] * pow(T, 2) / 2
                      + HS_a[i][2] * pow(T, 3) / 3
                      + HS_a[i][3] * pow(T, 4) / 4
                      + HS_a[i][4] * pow(T, 5) / 5
                      + HS_a[i][5]);
    return Ho_i;
}
```

这是标准的 **7 系数 Shomate/JANAF 多项式**，公式为：

$$
\frac{H}{R} = a_1 T + \frac{a_2 T^2}{2} + \frac{a_3 T^3}{3} + \frac{a_4 T^4}{4} + \frac{a_5 T^5}{5} + a_6
$$

### 2.2 H₂O 的 7 系数数据 (`RS-25in.in`)

从输入文件第 7 行可以看到 H₂O 的系数（第 4 种组分，对应 `HS_a[3]`）：

```
0.40701270E+01 -0.11084500E-02 0.41521180E-05 -0.29637400E-08 0.80702100E-12 -0.30279720E+05 -0.32270050E+00
```

即：
| 系数 | 数值 |
|------|------|
| $a_1$ | 4.0701270 |
| $a_2$ | -1.1084500×10⁻³ |
| $a_3$ | 4.1521180×10⁻⁶ |
| $a_4$ | -2.9637400×10⁻⁹ |
| $a_5$ | 8.0702100×10⁻¹³ |
| $a_6$ | -30279.720 |

---

## 3. 详细计算过程

### 3.1 在 T = 3471K 时计算 H₂O 焓

设 $R = 8.3144$ J/(mol·K)，代入公式：

$$
H = R \times \left( a_1 T + \frac{a_2 T^2}{2} + \frac{a_3 T^3}{3} + \frac{a_4 T^4}{4} + \frac{a_5 T^5}{5} + a_6 \right)
$$

各项计算（单位：kJ/mol）：

| 项                  | 公式                                                | T=3471K 时数值    |
| ------------------- | --------------------------------------------------- | ----------------- |
| $a_1 T$             | $4.0701270 \times 3471$                             | +117.5 kJ/mol     |
| $\frac{a_2 T^2}{2}$ | $\frac{-1.1084500 \times 10^{-3} \times 3471^2}{2}$ | **-55.5 kJ/mol**  |
| $\frac{a_3 T^3}{3}$ | $\frac{4.1521180 \times 10^{-6} \times 3471^3}{3}$  | **+481.2 kJ/mol** |
| $\frac{a_4 T^4}{4}$ | $\frac{-2.9637400 \times 10^{-9} \times 3471^4}{4}$ | **-894.2 kJ/mol** |
| $\frac{a_5 T^5}{5}$ | $\frac{8.0702100 \times 10^{-13} \times 3471^5}{5}$ | **+676.1 kJ/mol** |
| $a_6$               | $-30279.720$                                        | -251.8 kJ/mol     |
| **总和**            |                                                     | **+73.3 kJ/mol**  |

### 3.2 完整计算验证

```python
import math
R = 8.3144  # J/(mol·K)
T = 3471    # K

# H2O 的 7 系数
a = [4.0701270, -1.1084500e-3, 4.1521180e-6, -2.9637400e-9, 8.0702100e-13, -30279.720]

# 计算各项 (kJ/mol)
term1 = a[0] * T * R / 1000                    # = 117.52
term2 = a[1] * T**2 / 2 * R / 1000             # = -55.52
term3 = a[2] * T**3 / 3 * R / 1000             # = 481.19
term4 = a[3] * T**4 / 4 * R / 1000             # = -894.19
term5 = a[4] * T**5 / 5 * R / 1000             # = 676.14
term6 = a[5] * R / 1000                        # = -251.80

H_total = term1 + term2 + term3 + term4 + term5 + term6
print(f"H₂O 焓 (T=3471K) = {H_total:.2f} kJ/mol")
# 输出: H₂O 焓 (T=3471K) = +73.33 kJ/mol  ❌ 错误！
```

---

## 4. 为什么 +73.46 kJ/mol 是错误的？

### 4.1 焓的物理意义

热力学中，物质的焓以**元素单质在 298.15K 的标准状态**为参考零点。

对于 H₂O(g)：

- **298.15K 时的标准生成焓** = **-241.83 kJ/mol**
- 这个负值表示：从 H₂(g) + ½O₂(g) 生成 H₂O(g) 是**放热反应**

### 4.2 加热 H₂O 从 298K 到高温

当加热 H₂O 时，焓会增加（吸热），但增加的幅度有限：

$$
H(T) = H(298K) + \int_{298}^{T} C_p \, dT
$$

H₂O 的平均比热约 40-50 J/(mol·K)，从 298K 加热到 4000K：

$$
\Delta H \approx 45 \times (4000 - 298) = 166.6 \, \text{kJ/mol}
$$

因此 4000K 时的焓约为：

$$
H(4000K) \approx -241.8 + 166.6 = -75.2 \, \text{kJ/mol}
$$

**仍然是负值！**

### 4.3 NASA 9 系数的正确结果

使用 NASA Glenn 热力数据库的 9 系数多项式：

| 温度 (K) | 7 系数焓 (kJ/mol) | NASA 9 系数焓 (kJ/mol) | 误差                  |
| -------- | ----------------- | ---------------------- | --------------------- |
| 298      | -241.8            | -241.8                 | ~0                    |
| 1000     | -215.8            | -215.8                 | ~0                    |
| 2000     | -166.1            | -179.5                 | 13.4 kJ/mol           |
| **3000** | **-53.9**         | **-114.2**             | **60.3 kJ/mol** ⚠️    |
| **3471** | **+73.3**         | **-87.1**              | **160.4 kJ/mol** ❌   |
| **4000** | **+343.5**        | **-55.6**              | **399.1 kJ/mol** ❌❌ |

---

## 5. 问题根源：多项式外推失效

### 5.1 7 系数多项式的适用范围

7 系数（Shomate）多项式是**针对特定温度区间拟合**的，通常为 **300-1000K** 或 **1000-5000K**。

关键问题在于 $T^4$ 和 $T^5$ 项：

| 温度      | $\frac{a_4 T^4}{4}$ | $\frac{a_5 T^5}{5}$ | 说明                     |
| --------- | ------------------- | ------------------- | ------------------------ |
| 1000K     | -6.2 kJ/mol         | +1.3 kJ/mol         | 数值小，相互抵消         |
| 3000K     | -499.0 kJ/mol       | +326.1 kJ/mol       | 开始显著                 |
| **4000K** | **-1577.1 kJ/mol**  | **+1374.2 kJ/mol**  | **巨大数值的微小差异！** |

在高温下，$T^4$ 和 $T^5$ 项都变成了**上千 kJ/mol 的量级**，最终结果依赖于两个巨大数字的差值，这：

1. **数值不稳定**：微小的系数误差会被放大
2. **物理无意义**：这些系数是低温区拟合的，高温外推失去物理意义

### 5.2 为什么 NASA 9 系数有效？

NASA 9 系数多项式使用了**负幂次项** ($T^{-2}$, $T^{-1}$)：

$$
\frac{C_p}{R} = a_1 T^{-2} + a_2 T^{-1} + a_3 + a_4 T + a_5 T^2 + a_6 T^3 + a_7 T^4
$$

- 负幂次项在高温下趋近于零，不会失控
- 分段拟合（200-1000K, 1000-6000K），每段都有专门的系数
- 数据来源于实验测量和量子力学计算，可靠性高

---

## 6. 对燃烧温度计算的影响

### 6.1 焓守恒方程

燃烧室温度由焓守恒确定：

$$
H_{反应物}(T_{初始}) = H_{产物}(T_{燃烧})
$$

如果 $H_{产物}$ 被**高估**（如 H₂O 焓从 -87 kJ/mol 错算为 +73 kJ/mol），则需要**更低的温度**才能满足焓平衡，导致：

- 7 系数程序计算结果：**3471K** (偏低)
- NASA 9 系数正确结果：**~3916K**

### 6.2 误差传播

在 3471K 时，主要产物 H₂O 的焓误差约 **160 kJ/mol**。

对于 RS-25 发动机（O/F = 6.0），每 kg 推进剂产生约 3 mol H₂O：

- 总焓误差：~480 kJ/kg
- 相对于初始焓 (-987 kJ/kg) 这是一个**约 50% 的误差**！

---

## 7. 结论与建议

### 7.1 结论

| 项目           | 7 系数程序     | 本项目 (NASA 9) | 说明              |
| -------------- | -------------- | --------------- | ----------------- |
| H₂O 焓 (3471K) | +73 kJ/mol     | -87 kJ/mol      | 差 160 kJ/mol     |
| 燃烧温度       | 3471K (3198°C) | 3916K (3643°C)  | 差 445K           |
| 可靠性         | ❌ 错误        | ✅ 正确         | NASA 9 是行业标准 |

### 7.2 修复建议

1. **更换热力数据格式**：将 7 系数替换为 NASA 9 系数
2. **数据来源**：使用 `RPA-4.0.7/resources/thermo.inp` 或 NASA Glenn 数据库
3. **温度分段**：NASA 9 系数通常分 200-1000K 和 1000-6000K 两段

### 7.3 参考文献

- McBride, B.J., Gordon, S., "Computer Program for Calculation of Complex Chemical Equilibrium Compositions and Applications", NASA RP-1311, 1996
- NIST-JANAF Thermochemical Tables, 4th Edition
- RPA (Rocket Propulsion Analysis) Software, `thermo.inp` 数据库

---

## 附录：验证代码

```python
import math

def H_7coef(a, T):
    """7系数多项式计算焓 (kJ/mol)"""
    R = 8.3144
    H = R * (a[0]*T + a[1]*T**2/2 + a[2]*T**3/3 +
             a[3]*T**4/4 + a[4]*T**5/5 + a[5])
    return H / 1000

def H_NASA9(a_low, a_high, T):
    """NASA 9系数多项式计算焓 (kJ/mol)"""
    R = 8.3144
    a = a_low if T < 1000 else a_high
    H = R * T * (-a[0]/T**2 + a[1]*math.log(T)/T + a[2] +
                  a[3]*T/2 + a[4]*T**2/3 + a[5]*T**3/4 +
                  a[6]*T**4/5 + a[7]/T)
    return H / 1000

# H2O 的 7 系数 (来自 RS-25in.in)
H2O_7coef = [4.0701270, -1.1084500e-3, 4.1521180e-6,
             -2.9637400e-9, 8.0702100e-13, -30279.720]

# H2O 的 NASA 9 系数 (来自 thermo.inp)
H2O_NASA9_low = [-3.947960830e+04, 5.755731020e+02, 9.317826530e-01,
                  7.222712860e-03, -7.342557370e-06, 4.955043490e-09,
                 -1.336933246e-12, -3.303974310e+04]
H2O_NASA9_high = [1.034972096e+06, -2.412698562e+03, 4.646110780e+00,
                   2.291998307e-03, -6.836830480e-07, 9.426468930e-11,
                  -4.822380530e-15, -1.384286509e+04]

print("温度(K)  7系数(kJ/mol)  NASA9(kJ/mol)  误差")
for T in [298, 1000, 2000, 3000, 3471, 4000]:
    H7 = H_7coef(H2O_7coef, T)
    H9 = H_NASA9(H2O_NASA9_low, H2O_NASA9_high, T)
    print(f"{T:5}    {H7:+10.1f}     {H9:+10.1f}     {abs(H7-H9):6.1f}")
```
